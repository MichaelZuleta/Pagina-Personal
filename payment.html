<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Información del Cliente</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 1rem;
            text-align: center;
        }
        nav {
            margin: 1rem;
        }
        nav a {
            margin: 0 1rem;
            text-decoration: none;
            color: #333;
        }
        main {
            padding: 2rem;
        }
        footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: .2rem;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>

    <h2>Información del Cliente</h2>

    <!-- Formulario para ingresar los datos -->
    <form id="paymentForm">
        <label for="name">Nombre:</label>
        <input type="text" id="name" name="name" required><br><br>

        <label for="email">Correo Electrónico:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="phone">Teléfono:</label>
        <input type="text" id="phone" name="phone" required><br><br>

        <button type="submit">Confirmar Compra</button>
    </form>

    <h3>Productos en el Carrito</h3>
    <ul id="cartItemsList">
        <!-- Los productos del carrito se mostrarán aquí -->
    </ul>

    <script>
        // Mostrar los productos del carrito en esta página
        const cart = JSON.parse(localStorage.getItem('cart'));
        const cartItemsList = document.getElementById('cartItemsList');

        if (cart) {
            cart.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - $${item.price}`;
                cartItemsList.appendChild(li);
            });
        }

        // Enviar los datos al servidor cuando se envíe el formulario
        document.getElementById('paymentForm').addEventListener('submit', (e) => {
            e.preventDefault(); // Evitar el comportamiento por defecto del formulario

            const customerName = document.getElementById('name').value;
            const customerEmail = document.getElementById('email').value;
            const customerPhone = document.getElementById('phone').value;

            if (customerName && customerEmail && customerPhone) {
                // Enviar los datos y el carrito al servidor
                submitOrder(customerName, customerEmail, customerPhone);
            } else {
                alert("Por favor, completa todos los campos.");
            }
        });

        // Función para enviar la orden al servidor
        function submitOrder(customerName, customerEmail, customerPhone) {
            // Enviar los datos al servidor
            fetch('order.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `name=${customerName}&email=${customerEmail}&phone=${customerPhone}&cart=${JSON.stringify(cart)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message); // Mostrar mensaje de éxito
                    localStorage.removeItem('cart'); // Limpiar el carrito
                    window.location.href = 'thankyou.html'; // Redirigir a una página de agradecimiento
                } else {
                    alert("Error al procesar la compra: " + data.message);
                }
            })
            .catch(error => {
                alert("Hubo un error al procesar tu compra: " + error);
            });
        }
    </script>

</body>
</html>